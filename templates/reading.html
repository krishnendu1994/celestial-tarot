<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tarot Reading | Celestial Tarot</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;800&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --primary: #8B5FBF;
            --primary-dark: #6B3FA0;
            --secondary: #FF6B8B;
            --accent: #00C9B7;
            --light: #F8F5FF;
            --dark: #2D2B55;
            --text: #333333;
            --text-light: #666666;
            --border: #E6E1F0;
            --shadow: 0 10px 30px rgba(139, 95, 191, 0.1);
            --transition: all 0.3s ease;
            --radius: 15px;
            --primary-light: rgba(139, 95, 191, 0.1);
        }
        
        /* ===== Global Styles ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--text);
            background-color: white;
            line-height: 1.7;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            color: var(--dark);
            line-height: 1.3;
        }
        
        p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        section {
            padding: 100px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 70px;
        }
        
        .section-title h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }
        
        .section-title h2:after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .section-title p {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
        }
        
        a {
            text-decoration: none;
            color: inherit;
            transition: var(--transition);
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 16px 38px;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow);
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(139, 95, 191, 0.2);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }
        
        /* ===== Header & Navigation ===== */
        header {
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 12px;
            font-size: 1.8rem;
        }
        
        .logo span {
            color: var(--secondary);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 40px;
        }
        
        nav ul li a {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05rem;
            font-weight: 500;
            color: var(--dark);
            position: relative;
            padding: 5px 0;
        }
        
        nav ul li a:hover {
            color: var(--primary);
        }
        
        nav ul li a.active {
            color: var(--primary);
        }
        
        nav ul li a.active:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .mobile-menu-btn {
            display: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            background: none;
            border: none;
        }
        
        /* ===== Reading Container ===== */
        .reading-container {
            padding: 180px 0 100px;
            margin-top: 80px;
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), 
                        url('https://images.unsplash.com/photo-1533237264985-ee6c6d2be6d9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        /* ===== Question Section ===== */
        .question-section {
            background: white;
            padding: 50px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 60px;
            border-top: 5px solid var(--primary);
        }
        
        .question-section h2 {
            font-size: 2.2rem;
            margin-bottom: 30px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .question-section h2 i {
            color: var(--primary);
        }
        
        .question-input-container {
            margin-bottom: 30px;
        }
        
        .question-input {
            width: 100%;
            padding: 25px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            resize: vertical;
            min-height: 150px;
            transition: var(--transition);
            background: var(--light);
            line-height: 1.8;
        }
        
        .question-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 95, 191, 0.1);
            background: white;
        }
        
        .question-examples {
            background: var(--light);
            padding: 25px;
            border-radius: var(--radius);
            margin-top: 30px;
        }
        
        .question-examples h4 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .example-questions {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .example-btn {
            padding: 15px 20px;
            background: white;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--text);
        }
        
        .example-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .question-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        /* Free AI Badge */
        .free-ai-badge {
            background: linear-gradient(135deg, #00C9B7, #00a896);
            color: white;
            padding: 12px 25px;
            border-radius: var(--radius);
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* ===== Card Selection Section ===== */
        .card-selection-section {
            background: white;
            padding: 50px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 60px;
            border-top: 5px solid var(--secondary);
            display: none;
        }
        
        .selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .selection-header h2 {
            font-size: 2.2rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .selection-header h2 i {
            color: var(--secondary);
        }
        
        .selected-counter {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: var(--shadow);
        }
        
        .card-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 12px 28px;
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-family: 'Montserrat', sans-serif;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        /* ===== Card Deck ===== */
        .card-deck-container {
            position: relative;
            margin-bottom: 40px;
        }
        
        .card-deck {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(74px, 1fr));
            gap: 25px;
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius);
        }
        
        /* Individual Tarot Card Design */
        .tarot-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            height: 130px;
            perspective: 1000px;
            transform-style: preserve-3d;
        }
        

        
        .tarot-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .tarot-card.selected .tarot-card-inner {
            transform: rotateY(180deg);
        }
        
        .tarot-card-front, .tarot-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .tarot-card-front {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            transform: rotateY(180deg);
        }
        
        .tarot-card-back {
            background: url(https://upload.wikimedia.org/wikipedia/commons/thumb/f/fc/Waite%E2%80%93Smith_Tarot_Roses_and_Lilies_cropped.jpg/250px-Waite%E2%80%93Smith_Tarot_Roses_and_Lilies_cropped.jpg);
            background-size: cover;
            background-repeat: no-repeat;
            color: white;
        }
        /* .tarot-card-inner.selected {
            border: 6px solid #8e44ad;
            
        } */
         /* ===== Language Selector Styles ===== */
        .language-selector {
            position: static;
            top: 0;
            overflow: scroll;
            height: 500px;
            right: 20px;
            z-index: 1000;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 15px;
            border: 2px solid var(--border);
            min-width: 180px;
        }

        .language-selector h4 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .language-btn {
            padding: 10px 15px;
            background: var(--light);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-btn:hover {
            background: var(--primary-light);
            transform: translateX(-3px);
        }

        .language-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .language-btn .flag {
            font-size: 1.2rem;
        }

        .language-btn .name {
            flex-grow: 1;
        }

        @media (max-width: 768px) {
            .language-selector {
                position: static;
                margin: 20px auto;
                max-width: 300px;
            }
        }

        
        
        .tarot-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 15px 30px rgba(139, 95, 191, 0.2);
        }
        
        .tarot-card.selected {
            transform: translateY(-10px);
            box-shadow: 0 0 30px rgba(139, 95, 191, 0.4);
            border: 3px solid var(--primary);
        }
        
        .card-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .card-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            font-family: 'Playfair Display', serif;
        }
        
        .card-meaning {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.5;
            font-family: 'Cormorant Garamond', serif;
        }
        
        .card-symbol {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.2rem;
            opacity: 0.7;
        }
        
        .card-back .card-symbol {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            opacity: 0.3;
        }
        
        .card-back-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 20px;
            font-family: 'Playfair Display', serif;
        }
        
        .card-type {
            position: absolute;
            bottom: 15px;
            left: 15px;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        /* ===== Selected Cards Preview ===== */
        .selected-preview {
            background: var(--light);
            padding: 30px;
            border-radius: var(--radius);
            margin-bottom: 40px;
            display: none;
        }
        
        .selected-preview h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .selected-cards {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .selected-card-item {
            width: 150px;
            text-align: center;
        }
        
        .selected-card-visual {
            height: 220px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .selected-card-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .selected-card-position {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 500;
            background: var(--light);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        
        /* ===== Reading Actions ===== */
        .reading-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        /* ===== AI Reading Result ===== */
        .ai-reading-section {
            background: white;
            padding: 50px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 60px;
            border-top: 5px solid var(--accent);
            display: none;
        }
        
        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .ai-header h2 {
            font-size: 2.2rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .ai-header h2 i {
            color: var(--accent);
        }
        
        .ai-loading {
            text-align: center;
            padding: 40px;
        }
        
        .ai-loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-error {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .ai-error i {
            font-size: 3rem;
            color: #e74c3c;
            margin-bottom: 20px;
        }
        
        .ai-reading-content {
            display: none;
        }
        
        .card-positions {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }
        
        .position-card {
            width: 220px;
            background: var(--light);
            padding: 25px;
            border-radius: var(--radius);
            text-align: center;
            position: relative;
        }
        
        .position-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: var(--radius) var(--radius) 0 0;
        }
        
        .position-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .position-card-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .position-card-meaning {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 15px;
            min-height: 60px;
        }
        
        .ai-interpretation {
            background: var(--light);
            padding: 40px;
            border-radius: var(--radius);
            margin-bottom: 40px;
        }
        
        .ai-interpretation h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .interpretation-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: var(--text);
        }
        
        .ai-insights {
            background: white;
            border: 2px solid var(--border);
            padding: 30px;
            border-radius: var(--radius);
        }
        
        .ai-insights h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .insight-item {
            background: var(--light);
            padding: 20px;
            border-radius: var(--radius);
        }
        
        .insight-item h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        /* ===== Footer ===== */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 80px 0 40px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            margin-bottom: 50px;
        }
        
        .footer-col h4 {
            color: white;
            font-size: 1.4rem;
            margin-bottom: 25px;
            position: relative;
            padding-bottom: 15px;
        }
        .tarot-card-inner.selected {
            opacity: 0.3;
        }
        
        .footer-col h4:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background-color: var(--accent);
        }
        
        .footer-col p, .footer-col a {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 12px;
            display: block;
            font-family: 'Montserrat', sans-serif;
        }
        
        .footer-col a:hover {
            color: white;
            padding-left: 5px;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-links a {
            width: 42px;
            height: 42px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }
        .back{ border: none !important; }
        .social-links a:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
            padding-left: 0;
        }
        
        .copyright {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
            font-family: 'Montserrat', sans-serif;
        }
        
        /* ===== Responsive Design ===== */
        @media (max-width: 992px) {
            .footer-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .card-deck {
                grid-template-columns: repeat(auto-fill, minmax(74px, 1fr));
            }
            
            .position-card {
                width: 100%;
                max-width: 300px;
            }
            
            .insights-grid {
                grid-template-columns: repeat(auto-fill, minmax(74px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-container {
                padding: 15px 0;
            }
            
            nav {
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                background-color: white;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 30px 20px;
                transform: translateY(-150%);
                transition: var(--transition);
            }
            
            nav.active {
                transform: translateY(0);
            }
            
            nav ul {
                flex-direction: column;
            }
            
            nav ul li {
                margin: 0 0 20px 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .reading-container {
                padding: 150px 0 80px;
            }
            
            .question-section,
            .card-selection-section,
            .ai-reading-section {
                padding: 30px;
            }
            
            .selection-header,
            .ai-header,
            .question-actions {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .selected-counter {
                align-self: flex-start;
            }
            
            .card-deck {
                grid-template-columns: repeat(auto-fill, minmax(74px, 1fr));
            }
            
            .tarot-card {
                height: 250px;
            }
            
            .reading-actions {
                flex-direction: column;
            }
            
            .reading-actions .btn {
                width: 100%;
            }
            
            section {
                padding: 70px 0;
            }
        }
        
        @media (max-width: 576px) {
            .footer-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title h2 {
                font-size: 2.2rem;
            }
            
            .example-questions {
                grid-template-columns: 1fr;
            }
            
            .card-filter {
                justify-content: center;
            }
            
            .card-deck {
                grid-template-columns: repeat(auto-fill, minmax(74px, 1fr));
                gap: 15px;
            }
            
            .tarot-card {
                height: 220px;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }
        /* Tarot Spread Shuffle Animation */
        .tarot-card {
            transition: transform 0.8s ease, opacity 0.6s ease;
        }

        .spread-phase {
            opacity: 0.7;
        }

        .reset-phase {
            opacity: 1;
            transform: translate(0, 0) rotate(0deg) scale(1);
        }
        /* Add to existing CSS */
.tarot-card {
    transition: 
        transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275),
        opacity 0.4s ease,
        z-index 0.1s linear;
    will-change: transform, z-index;
}

/* Shuffle container styles */
.card-deck {
    position: relative;
    min-height: 400px;
    transition: all 0.3s ease;
}

/* During shuffle animation */
.shuffling .tarot-card {
    pointer-events: none;
}

.shuffling .card-deck {
    overflow: visible;
}

/* Shuffle button styles */
.shuffle-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.shuffle-controls button {
    padding: 12px 25px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    border-radius: 50px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(139, 95, 191, 0.2);
}

.shuffle-controls button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 95, 191, 0.3);
}

.shuffle-controls button:active {
    transform: translateY(0);
}

.shuffle-controls button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

    </style>
</head>
<body>
    <!-- Header & Navigation -->
    <header>
        <div class="container header-container">
            <a href="/" class="logo">
                <i class="fas fa-crystal-ball"></i>
                Celestial<span>Tarot</span>
            </a>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav id="mainNav">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="#" class="active">Tarot Reading</a></li>
                    <li><a href="cards">All Cards</a></li>
                    <li><a href="guidance">Guidance</a></li>
                    <li><a href="about">About</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Reading Container -->
    <div class="reading-container">
        <div class="container">
            <!-- Question Section -->
            <div class="question-section" id="questionSection">
                <h2><i class="fas fa-question-circle"></i> What Would You Like to Know?</h2>
                <p style="font-size: 1.2rem; color: var(--text-light); margin-bottom: 30px;">
                    Ask your question below. Our AI-powered tarot system will analyze your question and selected cards to provide a personalized, insightful reading using real AI models.
                </p>
                
                <div class="question-input-container">
                    <textarea class="question-input" id="questionInput" placeholder="Type your question here... For example: 'What should I focus on in my career for the next 6 months?' or 'What is blocking my progress in my current relationship?'"></textarea>
                    <!-- Language Selector -->
                    <div class="language-selector" id="languageSelector">
                        <h4><i class="fas fa-globe"></i> Language</h4>
                        <div class="language-options">
                            <!-- English -->
                            <button class="language-btn active" data-lang="English">
                                <span class="flag">üá∫üá∏</span>
                                <span class="name">English</span>
                                <i class="fas fa-check"></i>
                            </button>
                            
                            <!-- Indian Languages -->
                            <button class="language-btn" data-lang="Hindi">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
                            </button>
                            <button class="language-btn" data-lang="Bengali">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</span>
                            </button>
                            <button class="language-btn" data-lang="Tamil">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</span>
                            </button>
                            <button class="language-btn" data-lang="Telugu">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</span>
                            </button>
                            <button class="language-btn" data-lang="Marathi">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡§Æ‡§∞‡§æ‡§†‡•Ä</span>
                            </button>
                            <button class="language-btn" data-lang="Gujarati">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</span>
                            </button>
                            <button class="language-btn" data-lang="Kannada">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡≤ï‡≤®‡≥ç‡≤®‡≤°</span>
                            </button>
                            <button class="language-btn" data-lang="Malayalam">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</span>
                            </button>
                            <button class="language-btn" data-lang="Punjabi">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</span>
                            </button>
                            <button class="language-btn" data-lang="Urdu">
                                <span class="flag">üáÆüá≥</span>
                                <span class="name">ÿßÿ±ÿØŸà</span>
                            </button>
                            
                            <!-- Other International Languages -->
                            <button class="language-btn" data-lang="Spanish">
                                <span class="flag">üá™üá∏</span>
                                <span class="name">Espa√±ol</span>
                            </button>
                            <button class="language-btn" data-lang="French">
                                <span class="flag">üá´üá∑</span>
                                <span class="name">Fran√ßais</span>
                            </button>
                            <button class="language-btn" data-lang="German">
                                <span class="flag">üá©üá™</span>
                                <span class="name">Deutsch</span>
                            </button>
                            <button class="language-btn" data-lang="Italian">
                                <span class="flag">üáÆüáπ</span>
                                <span class="name">Italiano</span>
                            </button>
                            <button class="language-btn" data-lang="Portuguese">
                                <span class="flag">üáßüá∑</span>
                                <span class="name">Portugu√™s</span>
                            </button>
                            <button class="language-btn" data-lang="Arabic">
                                <span class="flag">üá∏üá¶</span>
                                <span class="name">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                            </button>
                            <button class="language-btn" data-lang="Chinese">
                                <span class="flag">üá®üá≥</span>
                                <span class="name">‰∏≠Êñá</span>
                            </button>
                            <button class="language-btn" data-lang="Japanese">
                                <span class="flag">üáØüáµ</span>
                                <span class="name">Êó•Êú¨Ë™û</span>
                            </button>
                            <button class="language-btn" data-lang="Korean">
                                <span class="flag">üá∞üá∑</span>
                                <span class="name">ÌïúÍµ≠Ïñ¥</span>
                            </button>
                            <button class="language-btn" data-lang="Russian">
                                <span class="flag">üá∑üá∫</span>
                                <span class="name">–†—É—Å—Å–∫–∏–π</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                
                <div class="question-examples">
                    <h4><i class="fas fa-lightbulb"></i> Example Questions:</h4>
                    <div class="example-questions">
                        <button class="example-btn" data-question="What do I need to know about my love life right now?">
                            <i class="fas fa-heart"></i> Love & Relationships
                        </button>
                        <button class="example-btn" data-question="What career path should I pursue for maximum fulfillment and success?">
                            <i class="fas fa-briefcase"></i> Career Guidance
                        </button>
                        <button class="example-btn" data-question="What is the main lesson I need to learn at this point in my life?">
                            <i class="fas fa-spa"></i> Personal Growth
                        </button>
                        <button class="example-btn" data-question="How can I improve my financial situation in the coming months?">
                            <i class="fas fa-coins"></i> Finance & Abundance
                        </button>
                    </div>
                </div>
                
                <div class="free-ai-badge">
                    <i class="fas fa-gift"></i>
                    <div>
                        <strong>Free AI Reading Included!</strong>
                        <div style="font-size: 0.9rem; opacity: 0.9;">Powered by Crystal Tarot AI</div>
                    </div>
                </div>
                
                <div class="question-actions">
                    <button class="btn-secondary back" onclick="window.location.href='/'">
                        <i class="fas fa-arrow-left"></i> Back to Home
                    </button>
                    <button class="btn" id="proceedToCardsBtn">
                        Next: Select Cards <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Card Selection Section -->
            <div class="card-selection-section" id="cardSelectionSection">
                <div class="selection-header">
                    <h2><i class="fas fa-layer-group"></i> Select 3 Tarot Cards</h2>
                    <div class="selected-counter" id="selectedCounter">Selected: 0/3</div>
                </div>
                
                <p style="font-size: 1.2rem; color: var(--text-light); margin-bottom: 30px;">
                    Click on cards to select them. The cards will flip to reveal their meaning. Trust your intuition when choosing.
                </p>
                
                <div class="card-filter">
                    <button class="filter-btn active" data-filter="all">All Cards</button>
                </div>
                
                <!-- Selected Cards Preview -->
                <div class="selected-preview" id="selectedPreview">
                    <h3><i class="fas fa-check-circle"></i> Your Selected Cards</h3>
                    <div class="selected-cards" id="selectedCardsContainer">
                        <!-- Selected cards will appear here -->
                    </div>
                </div>
                
                <!-- Card Deck -->
                <div class="card-deck-container">
                   <!-- Card Selection Section ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá -->
                    <div class="shuffle-controls">
                        <button onclick="animatedShuffle(1)" class="shuffle-btn">
                            <i class="fas fa-random"></i> Single Shuffle
                        </button>
                        <button onclick="animatedShuffle(3)" class="shuffle-btn">
                            <i class="fas fa-random"></i> Triple Shuffle
                        </button>
                        <button onclick="animatedShuffle(5)" class="shuffle-btn">
                            <i class="fas fa-random"></i> Full Shuffle
                        </button>
                    </div>


                    <div class="card-deck" id="cardDeck">
                        <!-- 78 cards will be generated by JavaScript -->
                    </div>
                </div>
                
                <div class="reading-actions">
                    <button class="btn-secondary back" style="border:none;" id="backToQuestionBtn">
                        <i class="fas fa-arrow-left"></i> Back to Question
                    </button>
                    <button class="btn" id="getAIReadingBtn" disabled>
                        <i class="fas fa-robot"></i> Get Free AI Reading
                    </button>
                </div>
            </div>
            
            <!-- AI Reading Result Section -->
            <div class="ai-reading-section" id="aiReadingSection">
                <div class="ai-header">
                    <h2><i class="fas fa-crystal-ball"></i> Your AI Tarot Reading</h2>
                    <div style="color: var(--accent); font-weight: 600;">
                        <i class="far fa-clock"></i> Generated just now
                    </div>
                </div>
                
                <div class="ai-loading" id="aiLoading">
                    <div class="ai-loading-spinner"></div>
                    <h3>Consulting AI Tarot Expert...</h3>
                    <p>Our AI is analyzing your question and selected cards to provide you with a personalized reading.</p>
                </div>
                
                <div class="ai-error" id="aiError">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Connection Error</h3>
                    <p id="errorMessage">Unable to connect to AI service. Using offline interpretation instead.</p>
                    <button class="btn" id="retryAIButton" style="margin-top: 20px;">
                        <i class="fas fa-redo"></i> Retry Connection
                    </button>
                </div>
                
                <div class="ai-reading-content" id="aiReadingContent">
                    <div class="card-positions" id="cardPositionsContainer">
                        <!-- Card positions will appear here -->
                    </div>
                    
                    <div class="ai-interpretation">
                        <h3><i class="fas fa-book-open"></i> AI Interpretation</h3>
                        <div class="interpretation-text" id="interpretationText">
                            <!-- AI-generated interpretation will appear here -->
                        </div>
                    </div>
                    
                    <div class="ai-insights" style="display: block;">
                        <h3><i class="fas fa-lightbulb"></i> AI-Generated Insights</h3>
                        <div class="insights-grid" id="insightsGrid">
                            <!-- Insights will appear here -->
                        </div>
                    </div>
                    
                    <div class="reading-actions">
                        <button class="btn-secondary" id="backToCardsFromReadingBtn">
                            <i class="fas fa-arrow-left"></i> Back to Card Selection
                        </button>
                        <button class="btn" id="newReadingBtn">
                            <i class="fas fa-redo"></i> Start New Reading
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Celestial Tarot</h4>
                    <p>Powered by real AI for authentic, personalized tarot readings.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-pinterest-p"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <a href="/">Home</a>
                    <a href="#" class="active">Tarot Reading</a>
                    <a href="cards">All Cards</a>
                    <a href="guidance">Learn Tarot</a>
                    <a href="about">About Us</a>
                </div>
                
                <div class="footer-col">
                    <h4>Reading Types</h4>
                    <a href="#">Three-Card Spread</a>
                    <a href="#">Celtic Cross</a>
                    <a href="#">Relationship Reading</a>
                    <a href="#">Career Guidance</a>
                    <a href="#">Past Life Reading</a>
                </div>
                
                <div class="footer-col">
                    <h4>AI Integration</h4>
                    <p><i class="fas fa-robot"></i> Free AI Readings</p>
                    <p><i class="fas fa-gem"></i> DeepSeek & Gemini AI</p>
                    <p><i class="fas fa-bolt"></i> Real-time interpretations</p>
                    <p style="margin-top: 20px; font-size: 0.9rem;">No API key required ‚Ä¢ Completely free</p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Celestial Tarot. All rights reserved. | <a href="#" style="color: var(--accent);">Privacy Policy</a> | <a href="#" style="color: var(--accent);">Terms of Service</a></p>
                <p style="margin-top: 10px; font-size: 0.85rem;">This system uses OpenRouter AI to generate authentic tarot interpretations. Readings are for guidance purposes only.</p>
            </div>
        </div>
    </footer>

    <script>
        // ===== Mobile Menu Toggle =====
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mainNav = document.getElementById('mainNav');
        
        mobileMenuBtn.addEventListener('click', function() {
            mainNav.classList.toggle('active');
            mobileMenuBtn.innerHTML = mainNav.classList.contains('active') 
                ? '<i class="fas fa-times"></i>' 
                : '<i class="fas fa-bars"></i>';
        });
        
        // ===== Tarot Card Data (Complete 78-card deck) =====
        const tarotDeck = {
            major: [
                { id: 0, name: "The Fool", meaning: "New beginnings, innocence, spontaneity, a free spirit", icon: "üë§", element: "Air", shortMeaning: "New beginnings, innocence", color: "#FFD700", keywords: ["beginnings", "faith", "spontaneity", "free spirit"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/RWS_Tarot_00_Fool.jpg/800px-RWS_Tarot_00_Fool.jpg" },
                { id: 1, name: "The Magician", meaning: "Manifestation, resourcefulness, power, inspired action", icon: "‚ö°", element: "Air", shortMeaning: "Manifestation, power", color: "#3498db", keywords: ["manifestation", "power", "skill", "concentration"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/RWS_Tarot_01_Magician.jpg/800px-RWS_Tarot_01_Magician.jpg" },
                { id: 2, name: "The High Priestess", meaning: "Intuition, unconscious knowledge, divine feminine, mystery", icon: "üåô", element: "Water", shortMeaning: "Intuition, mystery", color: "#8e44ad", keywords: ["intuition", "mystery", "subconscious", "divine feminine"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/RWS_Tarot_02_High_Priestess.jpg/800px-RWS_Tarot_02_High_Priestess.jpg" },
                { id: 3, name: "The Empress", meaning: "Femininity, beauty, nature, abundance, nurturing", icon: "üëë", element: "Earth", shortMeaning: "Femininity, abundance", color: "#2ecc71", keywords: ["femininity", "abundance", "nature", "nurturing"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/RWS_Tarot_03_Empress.jpg/800px-RWS_Tarot_03_Empress.jpg" },
                { id: 4, name: "The Emperor", meaning: "Authority, structure, control, fatherhood, foundation", icon: "üèõÔ∏è", element: "Fire", shortMeaning: "Authority, structure", color: "#e74c3c", keywords: ["authority", "structure", "control", "foundation"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/RWS_Tarot_04_Emperor.jpg/800px-RWS_Tarot_04_Emperor.jpg" },
                { id: 5, name: "The Hierophant", meaning: "Tradition, conformity, morality, ethics, spiritual guidance", icon: "‚õ™", element: "Earth", shortMeaning: "Tradition, conformity", color: "#f39c12", keywords: ["tradition", "conformity", "morality", "beliefs"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/RWS_Tarot_05_Hierophant.jpg/800px-RWS_Tarot_05_Hierophant.jpg" },
                { id: 6, name: "The Lovers", meaning: "Love, harmony, relationships, values alignment, choices", icon: "üíë", element: "Air", shortMeaning: "Love, relationships", color: "#e84393", keywords: ["love", "relationships", "alignment", "choices"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/RWS_Tarot_06_Lovers.jpg/800px-RWS_Tarot_06_Lovers.jpg" },
                { id: 7, name: "The Chariot", meaning: "Control, willpower, success, action, determination", icon: "üõ°Ô∏è", element: "Water", shortMeaning: "Control, willpower", color: "#00cec9", keywords: ["control", "willpower", "success", "determination"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/RWS_Tarot_07_Chariot.jpg/800px-RWS_Tarot_07_Chariot.jpg" },
                { id: 8, name: "Strength", meaning: "Courage, persuasion, influence, compassion, inner strength", icon: "ü¶Å", element: "Fire", shortMeaning: "Courage, compassion", color: "#e17055", keywords: ["courage", "compassion", "influence", "inner strength"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f5/RWS_Tarot_08_Strength.jpg/800px-RWS_Tarot_08_Strength.jpg" },
                { id: 9, name: "The Hermit", meaning: "Soul-searching, introspection, being alone, inner guidance", icon: "üßô", element: "Earth", shortMeaning: "Introspection, solitude", color: "#636e72", keywords: ["introspection", "solitude", "inner guidance", "searching"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/RWS_Tarot_09_Hermit.jpg/800px-RWS_Tarot_09_Hermit.jpg" },
                { id: 10, name: "Wheel of Fortune", meaning: "Good luck, karma, life cycles, destiny, turning points", icon: "üîÑ", element: "Fire", shortMeaning: "Luck, destiny, cycles", color: "#a29bfe", keywords: ["luck", "destiny", "cycles", "turning points"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg/800px-RWS_Tarot_10_Wheel_of_Fortune.jpg" },
                { id: 11, name: "Justice", meaning: "Justice, fairness, truth, cause and effect, law", icon: "‚öñÔ∏è", element: "Air", shortMeaning: "Justice, fairness", color: "#0984e3", keywords: ["justice", "fairness", "truth", "karma"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/RWS_Tarot_11_Justice.jpg/800px-RWS_Tarot_11_Justice.jpg" },
                { id: 12, name: "The Hanged Man", meaning: "Surrender, new perspective, enlightenment, sacrifice", icon: "üôÉ", element: "Water", shortMeaning: "Surrender, new perspective", color: "#00b894", keywords: ["surrender", "perspective", "enlightenment", "sacrifice"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/RWS_Tarot_12_Hanged_Man.jpg/800px-RWS_Tarot_12_Hanged_Man.jpg" },
                { id: 13, name: "Death", meaning: "Endings, change, transformation, transition, rebirth", icon: "üíÄ", element: "Water", shortMeaning: "Endings, transformation", color: "#2d3436", keywords: ["endings", "transformation", "transition", "rebirth"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/RWS_Tarot_13_Death.jpg/800px-RWS_Tarot_13_Death.jpg" },
                { id: 14, name: "Temperance", meaning: "Balance, moderation, patience, purpose, meaning", icon: "‚öóÔ∏è", element: "Fire", shortMeaning: "Balance, moderation", color: "#fd79a8", keywords: ["balance", "moderation", "patience", "purpose"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/RWS_Tarot_14_Temperance.jpg/800px-RWS_Tarot_14_Temperance.jpg" },
                { id: 15, name: "The Devil", meaning: "Shadow self, attachment, addiction, restriction, bondage", icon: "üòà", element: "Earth", shortMeaning: "Shadow self, addiction", color: "#6c5ce7", keywords: ["shadow self", "addiction", "restriction", "bondage"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/RWS_Tarot_15_Devil.jpg/800px-RWS_Tarot_15_Devil.jpg" },
                { id: 16, name: "The Tower", meaning: "Sudden change, upheaval, chaos, revelation, awakening", icon: "üè∞", element: "Fire", shortMeaning: "Sudden change, upheaval", color: "#d63031", keywords: ["sudden change", "upheaval", "chaos", "awakening"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/RWS_Tarot_16_Tower.jpg/800px-RWS_Tarot_16_Tower.jpg" },
                { id: 17, name: "The Star", meaning: "Hope, faith, purpose, renewal, spirituality, inspiration", icon: "‚≠ê", element: "Air", shortMeaning: "Hope, faith, inspiration", color: "#74b9ff", keywords: ["hope", "faith", "inspiration", "spirituality"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/RWS_Tarot_17_Star.jpg/800px-RWS_Tarot_17_Star.jpg" },
                { id: 18, name: "The Moon", meaning: "Illusion, fear, anxiety, subconscious, intuition", icon: "üåï", element: "Water", shortMeaning: "Illusion, fear, intuition", color: "#a29bfe", keywords: ["illusion", "fear", "intuition", "subconscious"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7f/RWS_Tarot_18_Moon.jpg/800px-RWS_Tarot_18_Moon.jpg" },
                { id: 19, name: "The Sun", meaning: "Joy, success, celebration, positivity, vitality", icon: "‚òÄÔ∏è", element: "Fire", shortMeaning: "Joy, success, vitality", color: "#fdcb6e", keywords: ["joy", "success", "positivity", "vitality"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/RWS_Tarot_19_Sun.jpg/800px-RWS_Tarot_19_Sun.jpg" },
                { id: 20, name: "Judgement", meaning: "Judgement, rebirth, inner calling, absolution, awakening", icon: "üìØ", element: "Fire", shortMeaning: "Judgement, rebirth", color: "#00cec9", keywords: ["judgement", "rebirth", "awakening", "absolution"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/RWS_Tarot_20_Judgement.jpg/800px-RWS_Tarot_20_Judgement.jpg" },
                { id: 21, name: "The World", meaning: "Completion, integration, accomplishment, travel, fulfillment", icon: "üåç", element: "Earth", shortMeaning: "Completion, accomplishment", color: "#55efc4", keywords: ["completion", "accomplishment", "integration", "fulfillment"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/RWS_Tarot_21_World.jpg/800px-RWS_Tarot_21_World.jpg" }
            ],
            cups: [
                { id: 22, name: "Ace of Cups", meaning: "New love, compassion, creativity, spiritual awakening, emotional beginning", icon: "üíß", element: "Water", shortMeaning: "New love, emotional beginning", color: "#3498db", keywords: ["love", "compassion", "creativity", "emotional start"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Cups01.jpg/800px-Cups01.jpg" },
                { id: 23, name: "Two of Cups", meaning: "Unified love, partnership, mutual attraction, connection, harmony", icon: "üíë", element: "Water", shortMeaning: "Partnership, mutual attraction", color: "#e84393", keywords: ["partnership", "attraction", "connection", "harmony"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Cups02.jpg/800px-Cups02.jpg" },
                { id: 24, name: "Three of Cups", meaning: "Celebration, friendship, creativity, community, joyous gatherings", icon: "üéâ", element: "Water", shortMeaning: "Celebration, friendship", color: "#9b59b6", keywords: ["celebration", "friendship", "community", "joy"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/7a/Cups03.jpg/500px-Cups03.jpg" },
                { id: 25, name: "Four of Cups", meaning: "Meditation, contemplation, reevaluation, apathy, missed opportunities", icon: "üßò", element: "Water", shortMeaning: "Contemplation, apathy", color: "#34495e", keywords: ["contemplation", "apathy", "reevaluation", "withdrawal"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Cups04.jpg/500px-Cups04.jpg" },
                { id: 26, name: "Five of Cups", meaning: "Loss, regret, disappointment, mourning, focusing on the negative", icon: "üòî", element: "Water", shortMeaning: "Loss, regret, disappointment", color: "#7f8c8d", keywords: ["loss", "regret", "disappointment", "grief"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Cups05.jpg/500px-Cups05.jpg" },
                { id: 27, name: "Six of Cups", meaning: "Innocence, nostalgia, childhood memories, simplicity, familiarity", icon: "üé†", element: "Water", shortMeaning: "Nostalgia, childhood memories", color: "#f1c40f", keywords: ["nostalgia", "memories", "innocence", "simplicity"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/Cups06.jpg/500px-Cups06.jpg" },
                { id: 28, name: "Seven of Cups", meaning: "Choices, imagination, wishful thinking, opportunities, illusions", icon: "üåà", element: "Water", shortMeaning: "Choices, imagination, illusions", color: "#1abc9c", keywords: ["choices", "imagination", "opportunities", "illusions"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Cups07.jpg/500px-Cups07.jpg" },
                { id: 29, name: "Eight of Cups", meaning: "Walking away, disillusionment, leaving behind, searching for meaning", icon: "üö∂", element: "Water", shortMeaning: "Walking away, disillusionment", color: "#95a5a6", keywords: ["walking away", "disillusionment", "searching", "abandonment"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cups08.jpg/500px-Cups08.jpg" },
                { id: 30, name: "Nine of Cups", meaning: "Contentment, satisfaction, gratitude, wish fulfilled, emotional stability", icon: "üòä", element: "Water", shortMeaning: "Contentment, wish fulfilled", color: "#f39c12", keywords: ["contentment", "satisfaction", "gratitude", "wishes"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Cups09.jpg/500px-Cups09.jpg" },
                { id: 31, name: "Ten of Cups", meaning: "Divine love, blissful relationships, harmony, happy family, emotional fulfillment", icon: "üè°", element: "Water", shortMeaning: "Blissful relationships, harmony", color: "#2ecc71", keywords: ["harmony", "family", "emotional fulfillment", "bliss"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Cups10.jpg/500px-Cups10.jpg" },
                { id: 32, name: "Page of Cups", meaning: "Creative opportunities, intuitive messages, curiosity, new feelings", icon: "üßö", element: "Water", shortMeaning: "Creative opportunities, intuitive messages", color: "#3498db", keywords: ["creativity", "intuition", "curiosity", "new feelings"], image: "hhttps://upload.wikimedia.org/wikipedia/commons/thumb/a/ad/Cups11.jpg/500px-Cups11.jpg" },
                { id: 33, name: "Knight of Cups", meaning: "Romance, charm, imagination, following heart, poetic nature", icon: "ü§†", element: "Water", shortMeaning: "Romance, charm, following heart", color: "#9b59b6", keywords: ["romance", "charm", "imagination", "poetic"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Cups12.jpg/500px-Cups12.jpg" },
                { id: 34, name: "Queen of Cups", meaning: "Compassion, emotional security, intuition, calm, nurturing love", icon: "üë∏", element: "Water", shortMeaning: "Compassion, emotional security", color: "#e84393", keywords: ["compassion", "intuition", "nurturing", "calm"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/62/Cups13.jpg/500px-Cups13.jpg" },
                { id: 35, name: "King of Cups", meaning: "Emotional balance, compassion, diplomacy, control of feelings", icon: "ü§¥", element: "Water", shortMeaning: "Emotional balance, compassion", color: "#0984e3", keywords: ["emotional balance", "compassion", "diplomacy", "control"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Cups14.jpg/500px-Cups14.jpg" }
            ],
            wands: [
                { id: 36, name: "Ace of Wands", meaning: "Inspiration, new opportunities, growth, potential, creative spark", icon: "üî•", element: "Fire", shortMeaning: "Inspiration, new opportunities", color: "#e74c3c", keywords: ["inspiration", "opportunities", "growth", "creative spark"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Wands01.jpg/800px-Wands01.jpg" },
                { id: 37, name: "Two of Wands", meaning: "Future planning, progress, decisions, discovery, leaving comfort zone", icon: "üó∫Ô∏è", element: "Fire", shortMeaning: "Future planning, decisions", color: "#d35400", keywords: ["planning", "decisions", "progress", "discovery"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0f/Wands02.jpg/500px-Wands02.jpg" },
                { id: 38, name: "Three of Wands", meaning: "Expansion, foresight, overseas opportunities, progress, leadership", icon: "üëÅÔ∏è", element: "Fire", shortMeaning: "Expansion, foresight", color: "#f39c12", keywords: ["expansion", "foresight", "opportunities", "leadership"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/ff/Wands03.jpg/500px-Wands03.jpg" },
                { id: 39, name: "Four of Wands", meaning: "Celebration, harmony, marriage, home, community, stability", icon: "üè†", element: "Fire", shortMeaning: "Celebration, harmony, home", color: "#2ecc71", keywords: ["celebration", "harmony", "home", "community"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Wands04.jpg/500px-Wands04.jpg" },
                { id: 40, name: "Five of Wands", meaning: "Conflict, disagreements, competition, tension, rivals", icon: "‚öîÔ∏è", element: "Fire", shortMeaning: "Conflict, competition, tension", color: "#c0392b", keywords: ["conflict", "competition", "tension", "rivalry"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Wands05.jpg/500px-Wands05.jpg" },
                { id: 41, name: "Six of Wands", meaning: "Victory, success, public recognition, progress, self-confidence", icon: "üèÜ", element: "Fire", shortMeaning: "Victory, success, recognition", color: "#f1c40f", keywords: ["victory", "success", "recognition", "confidence"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Wands06.jpg/500px-Wands06.jpg" },
                { id: 42, name: "Seven of Wands", meaning: "Challenge, competition, perseverance, defense, maintaining control", icon: "üõ°Ô∏è", element: "Fire", shortMeaning: "Challenge, perseverance", color: "#7f8c8d", keywords: ["challenge", "perseverance", "defense", "control"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Wands07.jpg/500px-Wands07.jpg" },
                { id: 43, name: "Eight of Wands", meaning: "Swift action, movement, quick decisions, travel, rapid progress", icon: "üí®", element: "Fire", shortMeaning: "Swift action, movement", color: "#3498db", keywords: ["action", "movement", "progress", "travel"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Wands08.jpg/500px-Wands08.jpg" },
                { id: 44, name: "Nine of Wands", meaning: "Resilience, courage, persistence, boundaries, defensive position", icon: "üõ°Ô∏è", element: "Fire", shortMeaning: "Resilience, persistence", color: "#8e44ad", keywords: ["resilience", "courage", "persistence", "boundaries"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/Tarot_Nine_of_Wands.jpg/500px-Tarot_Nine_of_Wands.jpg" },
                { id: 45, name: "Ten of Wands", meaning: "Burden, responsibility, hard work, completion, stress", icon: "üíº", element: "Fire", shortMeaning: "Burden, responsibility, hard work", color: "#2c3e50", keywords: ["burden", "responsibility", "hard work", "stress"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0b/Wands10.jpg/500px-Wands10.jpg" },
                { id: 46, name: "Page of Wands", meaning: "Exploration, excitement, freedom, discovery, enthusiasm", icon: "üßö", element: "Fire", shortMeaning: "Exploration, excitement, freedom", color: "#e74c3c", keywords: ["exploration", "excitement", "freedom", "enthusiasm"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Wands11.jpg/500px-Wands11.jpg" },
                { id: 47, name: "Knight of Wands", meaning: "Action, adventure, fearlessness, energy, passion", icon: "ü§†", element: "Fire", shortMeaning: "Action, adventure, passion", color: "#f39c12", keywords: ["action", "adventure", "passion", "energy"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Wands12.jpg/500px-Wands12.jpg" },
                { id: 48, name: "Queen of Wands", meaning: "Courage, determination, joy, vibrancy, confidence", icon: "üë∏", element: "Fire", shortMeaning: "Courage, determination, confidence", color: "#f1c40f", keywords: ["courage", "determination", "confidence", "vibrancy"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Wands13.jpg/500px-Wands13.jpg" },
                { id: 49, name: "King of Wands", meaning: "Natural-born leader, vision, entrepreneur, charisma, taking action", icon: "ü§¥", element: "Fire", shortMeaning: "Leadership, vision, charisma", color: "#d35400", keywords: ["leadership", "vision", "charisma", "action"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Wands14.jpg/500px-Wands14.jpg" }
            ],
            swords: [
                { id: 50, name: "Ace of Swords", meaning: "Breakthrough, clarity, sharp mind, new idea, truth", icon: "‚öîÔ∏è", element: "Air", shortMeaning: "Breakthrough, clarity, truth", color: "#95a5a6", keywords: ["breakthrough", "clarity", "truth", "new idea"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Swords01.jpg/500px-Swords01.jpg" },
                { id: 51, name: "Two of Swords", meaning: "Difficult decisions, indecision, stalemate, blocked emotions", icon: "‚öñÔ∏è", element: "Air", shortMeaning: "Indecision, stalemate", color: "#7f8c8d", keywords: ["indecision", "stalemate", "choices", "blocked"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/Swords02.jpg/500px-Swords02.jpg" },
                { id: 52, name: "Three of Swords", meaning: "Heartbreak, emotional pain, sorrow, grief, separation", icon: "üíî", element: "Air", shortMeaning: "Heartbreak, sorrow, grief", color: "#c0392b", keywords: ["heartbreak", "sorrow", "grief", "pain"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/Swords03.jpg/500px-Swords03.jpg" },
                { id: 53, name: "Four of Swords", meaning: "Rest, restoration, contemplation, recuperation, meditation", icon: "üò¥", element: "Air", shortMeaning: "Rest, restoration, contemplation", color: "#3498db", keywords: ["rest", "restoration", "contemplation", "recuperation"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/Swords04.jpg/500px-Swords04.jpg" },
                { id: 54, name: "Five of Swords", meaning: "Conflict, tension, loss, defeat, betrayal, winning at all costs", icon: "üòû", element: "Air", shortMeaning: "Conflict, defeat, betrayal", color: "#2c3e50", keywords: ["conflict", "defeat", "betrayal", "tension"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Swords05.jpg/500px-Swords05.jpg" },
                { id: 55, name: "Six of Swords", meaning: "Transition, change, rite of passage, release, moving on", icon: "‚õµ", element: "Air", shortMeaning: "Transition, change, moving on", color: "#00cec9", keywords: ["transition", "change", "moving on", "release"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Swords06.jpg/500px-Swords06.jpg" },
                { id: 56, name: "Seven of Swords", meaning: "Betrayal, deception, getting away with something, stealth, strategy", icon: "ü¶π", element: "Air", shortMeaning: "Betrayal, deception, strategy", color: "#636e72", keywords: ["betrayal", "deception", "strategy", "stealth"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Swords07.jpg/500px-Swords07.jpg" },
                { id: 57, name: "Eight of Swords", meaning: "Restriction, confusion, powerlessness, victim mentality", icon: "üòñ", element: "Air", shortMeaning: "Restriction, confusion, powerlessness", color: "#2c3e50", keywords: ["restriction", "confusion", "powerlessness", "victim"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Swords08.jpg/500px-Swords08.jpg" },
                { id: 58, name: "Nine of Swords", meaning: "Anxiety, worry, fear, depression, nightmares, guilt", icon: "üò∞", element: "Air", shortMeaning: "Anxiety, worry, fear", color: "#34495e", keywords: ["anxiety", "worry", "fear", "guilt"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Swords09.jpg/500px-Swords09.jpg" },
                { id: 59, name: "Ten of Swords", meaning: "Painful endings, deep wounds, betrayal, loss, rock bottom", icon: "üó°Ô∏è", element: "Air", shortMeaning: "Painful endings, betrayal", color: "#2c3e50", keywords: ["endings", "betrayal", "pain", "rock bottom"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Swords10.jpg/500px-Swords10.jpg" },
                { id: 60, name: "Page of Swords", meaning: "Curiosity, restlessness, mental energy, new ideas, vigilance", icon: "üßö", element: "Air", shortMeaning: "Curiosity, mental energy, new ideas", color: "#3498db", keywords: ["curiosity", "mental energy", "ideas", "vigilance"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Swords11.jpg/500px-Swords11.jpg" },
                { id: 61, name: "Knight of Swords", meaning: "Ambitious, action-oriented, direct communication, haste, impulsiveness", icon: "ü§†", element: "Air", shortMeaning: "Ambition, action, directness", color: "#7f8c8d", keywords: ["ambition", "action", "directness", "haste"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/Swords12.jpg/500px-Swords12.jpg" },
                { id: 62, name: "Queen of Swords", meaning: "Independent, unbiased judgment, clear boundaries, perceptive, honest", icon: "üë∏", element: "Air", shortMeaning: "Independence, clear judgment, honesty", color: "#95a5a6", keywords: ["independence", "judgment", "honesty", "perceptive"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Swords13.jpg/500px-Swords13.jpg" },
                { id: 63, name: "King of Swords", meaning: "Mental clarity, intellectual power, authority, truth, command", icon: "ü§¥", element: "Air", shortMeaning: "Mental clarity, authority, truth", color: "#2c3e50", keywords: ["clarity", "authority", "truth", "intellect"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Swords14.jpg/500px-Swords14.jpg" }
            ],
            pentacles: [
                { id: 64, name: "Ace of Pentacles", meaning: "New financial opportunity, prosperity, new job, manifestation", icon: "üí∞", element: "Earth", shortMeaning: "Financial opportunity, prosperity", color: "#27ae60", keywords: ["opportunity", "prosperity", "manifestation", "wealth"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/fd/Pents01.jpg/500px-Pents01.jpg" },
                { id: 65, name: "Two of Pentacles", meaning: "Balance, adaptability, time management, prioritization, juggling", icon: "‚öñÔ∏è", element: "Earth", shortMeaning: "Balance, adaptability, juggling", color: "#2ecc71", keywords: ["balance", "adaptability", "juggling", "priorities"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Pents02.jpg/500px-Pents02.jpg" },
                { id: 66, name: "Three of Pentacles", meaning: "Teamwork, collaboration, learning, implementation, mastery", icon: "üë•", element: "Earth", shortMeaning: "Teamwork, collaboration, learning", color: "#f39c12", keywords: ["teamwork", "collaboration", "learning", "mastery"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Pents03.jpg/500px-Pents03.jpg" },
                { id: 67, name: "Four of Pentacles", meaning: "Conservation, frugality, security, control, possessiveness", icon: "üíé", element: "Earth", shortMeaning: "Security, control, possessiveness", color: "#d35400", keywords: ["security", "control", "possessiveness", "conservation"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Pents04.jpg/500px-Pents04.jpg" },
                { id: 68, name: "Five of Pentacles", meaning: "Financial loss, poverty, isolation, worry, hardship", icon: "üòî", element: "Earth", shortMeaning: "Financial loss, hardship, isolation", color: "#7f8c8d", keywords: ["loss", "hardship", "isolation", "poverty"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Pents05.jpg/500px-Pents05.jpg" },
                { id: 69, name: "Six of Pentacles", meaning: "Generosity, charity, giving, receiving, sharing wealth, balance", icon: "ü§≤", element: "Earth", shortMeaning: "Generosity, charity, sharing", color: "#27ae60", keywords: ["generosity", "charity", "sharing", "balance"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a6/Pents06.jpg/500px-Pents06.jpg" },
                { id: 70, name: "Seven of Pentacles", meaning: "Long-term view, sustainable results, perseverance, patience, investment", icon: "üå±", element: "Earth", shortMeaning: "Patience, long-term view, investment", color: "#2ecc71", keywords: ["patience", "long-term", "investment", "perseverance"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Pents07.jpg/500px-Pents07.jpg" },
                { id: 71, name: "Eight of Pentacles", meaning: "Apprenticeship, repetitive tasks, mastery, skill development, diligence", icon: "üî®", element: "Earth", shortMeaning: "Skill development, mastery, diligence", color: "#f39c12", keywords: ["skill", "mastery", "diligence", "craftsmanship"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Pents08.jpg/500px-Pents08.jpg" },
                { id: 72, name: "Nine of Pentacles", meaning: "Abundance, luxury, self-sufficiency, financial independence, rewards", icon: "üè°", element: "Earth", shortMeaning: "Abundance, self-sufficiency, luxury", color: "#27ae60", keywords: ["abundance", "self-sufficiency", "luxury", "rewards"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Pents09.jpg/500px-Pents09.jpg" },
                { id: 73, name: "Ten of Pentacles", meaning: "Wealth, financial security, family, long-term success, legacy", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", element: "Earth", shortMeaning: "Wealth, family, legacy, security", color: "#2ecc71", keywords: ["wealth", "family", "legacy", "security"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Pents10.jpg/500px-Pents10.jpg" },
                { id: 74, name: "Page of Pentacles", meaning: "Manifestation, financial opportunity, new skill development, ambition", icon: "üßö", element: "Earth", shortMeaning: "Manifestation, opportunity, ambition", color: "#27ae60", keywords: ["manifestation", "opportunity", "ambition", "learning"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/Pents11.jpg/500px-Pents11.jpg" },
                { id: 75, name: "Knight of Pentacles", meaning: "Efficiency, routine, conservatism, responsibility, hard work", icon: "ü§†", element: "Earth", shortMeaning: "Efficiency, responsibility, hard work", color: "#d35400", keywords: ["efficiency", "responsibility", "hard work", "routine"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d5/Pents12.jpg/500px-Pents12.jpg" },
                { id: 76, name: "Queen of Pentacles", meaning: "Nurturing, practical, provides for others, financially independent, down-to-earth", icon: "üë∏", element: "Earth", shortMeaning: "Nurturing, practical, financial independence", color: "#2ecc71", keywords: ["nurturing", "practical", "financial independence", "grounded"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/Pents13.jpg/500px-Pents13.jpg" },
                { id: 77, name: "King of Pentacles", meaning: "Wealth, business, leadership, security, abundance, reliability", icon: "ü§¥", element: "Earth", shortMeaning: "Wealth, business, leadership, reliability", color: "#f39c12", keywords: ["wealth", "business", "leadership", "reliability"], image: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1c/Pents14.jpg/500px-Pents14.jpg" }
            ]
        };


        // ===== Application State =====
        let userQuestion = "";
        let selectedCards = [];
        let currentFilter = "all";
        
        // ===== DOM Elements =====
        const questionSection = document.getElementById('questionSection');
        const cardSelectionSection = document.getElementById('cardSelectionSection');
        const aiReadingSection = document.getElementById('aiReadingSection');
        const cardDeck = document.getElementById('cardDeck');
        const selectedCounter = document.getElementById('selectedCounter');
        const selectedPreview = document.getElementById('selectedPreview');
        const selectedCardsContainer = document.getElementById('selectedCardsContainer');
        const questionInput = document.getElementById('questionInput');
        const proceedToCardsBtn = document.getElementById('proceedToCardsBtn');
        const backToQuestionBtn = document.getElementById('backToQuestionBtn');
        const getAIReadingBtn = document.getElementById('getAIReadingBtn');
        const aiLoading = document.getElementById('aiLoading');
        const aiError = document.getElementById('aiError');
        const errorMessage = document.getElementById('errorMessage');
        const retryAIButton = document.getElementById('retryAIButton');
        const aiReadingContent = document.getElementById('aiReadingContent');
        const cardPositionsContainer = document.getElementById('cardPositionsContainer');
        const interpretationText = document.getElementById('interpretationText');
        const insightsGrid = document.getElementById('insightsGrid');
        const backToCardsFromReadingBtn = document.getElementById('backToCardsFromReadingBtn');
        const newReadingBtn = document.getElementById('newReadingBtn');

        // ===== FREE AI Integration with OpenRouter =====

        // List of FREE AI models available through OpenRouter
        const FREE_AI_MODELS = [
            {
                id: "openai/gpt-5.2",
                name: "Open AI",
                free: true,
                provider: "OpenAI"
            },
            {
                id: "deepseek/deepseek-chat",
                name: "DeepSeek Chat",
                free: true,
                provider: "DeepSeek"
            },
            {
                id: "google/gemini-pro",
                name: "Google Gemini Pro",
                free: true,
                provider: "Google"
            },
            {
                id: "mistralai/mistral-7b-instruct",
                name: "Mistral 7B",
                free: true,
                provider: "Mistral"
            },
            {
                id: "huggingfaceh4/zephyr-7b-beta",
                name: "Zephyr 7B",
                free: true,
                provider: "Hugging Face"
            }
        ];

        // Get a free OpenRouter API key
        const OPENROUTER_API_KEY = "{{ aikey }}";

        // ===== Initialize Application =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeCards();
            setupEventListeners();
            
            // Set up example question buttons
            document.querySelectorAll('.example-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    questionInput.value = this.dataset.question;
                    userQuestion = this.dataset.question;
                });
            });
            
            // Set up filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active filter button
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Filter cards
                    currentFilter = this.dataset.filter;
                    filterCards(currentFilter);
                });
            });
        });

        // ===== Initialize All 78 Cards =====
        // ===== Initialize All 78 Cards =====
function initializeCards() {
    cardDeck.innerHTML = '';
    
    // Combine all cards into one array PROPERLY
    const allCards = [];
    
    // Add ALL cards in one go
    Object.keys(tarotDeck).forEach(suit => {
        tarotDeck[suit].forEach(card => {
            allCards.push({
                ...card,
                type: suit // 'major', 'cups', 'wands', etc.
            });
        });
    });
    
    // ‚úÖ CORRECT: Shuffle the CARD DATA
    const shuffledCards = shuffleArray(allCards);
    
    // Create card elements from SHUFFLED data
    shuffledCards.forEach(card => {
        const cardElement = document.createElement('div');
        cardElement.className = 'tarot-card';
        cardElement.dataset.id = card.id;
        cardElement.dataset.type = card.type;
        
        // Check if this card is already selected
        const isSelected = selectedCards.some(selected => selected.id === card.id);
        
        cardElement.innerHTML = `
            <div class="tarot-card-inner ${isSelected ? 'selected' : ''}">
                <div class="tarot-card-front" style="background: linear-gradient(135deg, ${card.color}, ${getTypeColor(card.type)})">
                    <div class="card-icon">${card.icon}</div>
                    <div class="card-name">${card.name}</div>
                    <div class="card-meaning">${card.shortMeaning}</div>
                    <div class="card-symbol">${getTypeSymbol(card.type)}</div>
                    <div class="card-type">${getTypeName(card.type)}</div>
                </div>
                <div class="tarot-card-back">
                    <div class="card-symbol">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
            </div>
        `;
        
        cardElement.addEventListener('click', function() {
            toggleCardSelection(card);
        });
        
        cardDeck.appendChild(cardElement);
    });
    
    // Update selected counter
    updateSelectedCounter();
}

        // ===== Card Selection Functions =====
        function toggleCardSelection(card) {
            const cardIndex = selectedCards.findIndex(c => c.id === card.id);
            const isAlreadySelected = selectedCards.some(c => c.id === card.id);
                    if (isAlreadySelected) {
                // Card is already selected - do nothing (can't unselect)
                return;
            }
            
            if (cardIndex !== -1) {
                // Deselect card
                selectedCards.splice(cardIndex, 1);
            } else {
                // Check if we can select more cards
                if (selectedCards.length >= 3) {
                    alert('You can only select 3 cards for a reading.');
                    return;
                }
                
                // Add card to selection
                selectedCards.push({
                    id: card.id,
                    name: card.name,
                    meaning: card.meaning,
                    shortMeaning: card.shortMeaning,
                    icon: card.icon,
                    color: card.color,
                    type: card.type,
                    element: card.element,
                    keywords: card.keywords,
                    image: card.image
                });
            }
            
            // Update card visual state
            const cardElement = document.querySelector(`.tarot-card[data-id="${card.id}"]`);
            if (cardElement) {
                const cardInner = cardElement.querySelector('.tarot-card-inner');
                if (selectedCards.some(c => c.id === card.id)) {
                    cardInner.classList.add('selected');
                } else {
                    cardInner.classList.remove('selected');
                }
            }
            
            // Update UI
            updateSelectedCounter();
            updateSelectedPreview();
            
            // Enable/disable reading button
            getAIReadingBtn.disabled = selectedCards.length !== 3;
        }

        function updateSelectedCounter() {
            selectedCounter.textContent = `Selected: ${selectedCards.length}/3`;
            
            // Show/hide preview section
            if (selectedCards.length > 0) {
                selectedPreview.style.display = 'block';
            } else {
                selectedPreview.style.display = 'none';
            }
        }

        function updateSelectedPreview() {
            selectedCardsContainer.innerHTML = '';
            
            const positions = ["Past", "Present", "Future"];
            
            selectedCards.forEach((card, index) => {
                const position = positions[index] || "Additional";
                
                const cardElement = document.createElement('div');
                cardElement.className = 'selected-card-item';
                cardElement.innerHTML = `
                    <div class="selected-card-visual" style="background: linear-gradient(135deg, ${card.color}, ${getTypeColor(card.type)})">
                         <img src="${card.image}" alt="${card.name}" style="width:100%;height: 190px;object-fit: fill;object-position:center;">
                         <div class="selected-card-name">${card.name}</div>
                    </div>
                    <div class="selected-card-position">${position}</div>
                `;
                
                selectedCardsContainer.appendChild(cardElement);
            });
        }

        function filterCards(filterType) {
            const cards = document.querySelectorAll('.tarot-card');
            
            cards.forEach(card => {
                if (filterType === 'all' || card.dataset.type === filterType) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // ===== Navigation Functions =====
        function proceedToCardSelection() {
            // Get user's question
            userQuestion = questionInput.value.trim();
            
            if (!userQuestion) {
                alert('Please enter your question before proceeding.');
                return;
            }
            
            // Simple validation
            if (userQuestion.length < 5) {
                alert('Please enter a more detailed question for a meaningful reading.');
                return;
            }
            
            // Hide question section, show card selection
            questionSection.style.display = 'none';
            cardSelectionSection.style.display = 'block';
            
            // Scroll to top of section
            cardSelectionSection.scrollIntoView({ behavior: 'smooth' });
        }

        function backToQuestion() {
            // Hide card selection, show question section
            cardSelectionSection.style.display = 'none';
            questionSection.style.display = 'block';
            
            // Scroll to top of section
            questionSection.scrollIntoView({ behavior: 'smooth' });
        }
        // Language selector functionality
        let selectedLanguage = "English";

        // Set up language selector buttons
        document.querySelectorAll('.language-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.language-btn').forEach(b => {
                    b.classList.remove('active');
                    b.querySelector('i')?.remove();
                });
                
                this.classList.add('active');
                this.innerHTML += '<i class="fas fa-check"></i>';
                
                // Set selected language
                selectedLanguage = this.dataset.lang;
                console.log(`Language set to: ${selectedLanguage}`);
            });
        });

        // ===== FREE AI Functions =====
        async function callFreeAI() {
            try {
                // Select a random free model
                const model = FREE_AI_MODELS[Math.floor(Math.random() * FREE_AI_MODELS.length)];
                
                // Prepare the prompt for AI
                const positions = ["Past Influences", "Present Situation", "Future Potential"];
                const cardDescriptions = selectedCards.map((card, index) => 
                    `‚Ä¢ ${positions[index]}: ${card.name} - ${card.meaning}`
                ).join('\n');
                 const languageToUse = selectedLanguage;
                
                const prompt = `As an expert tarot reader, analyze this 3-card tarot spread:

USER'S QUESTION: "${userQuestion}"

SELECTED CARDS:
${cardDescriptions}

Please provide a detailed tarot reading that:
1. Interprets each card in its position (past, present, future)
2. Shows how the cards connect to each other
3. Relates the reading to the user's specific question
4. Offers practical insights and guidance
5. Maintains a compassionate, insightful tone

Format your response as a clear, well-structured tarot reading and answer in ${languageToUse} language.`;

                // Call OpenRouter API (free tier)
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.origin, // Required for OpenRouter
                        'X-Title': 'Celestial Tarot' // Your app name
                    },
                    body: JSON.stringify({
                        model: model.id,
                        messages: [
                            {
                                role: 'system',
                                content: 'You are an expert tarot reader with deep knowledge of tarot symbolism, psychology, and spiritual guidance. Provide thoughtful, nuanced interpretations that are both insightful and practical. Focus on empowerment and self-discovery.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    // Try with alternative model if first fails
                    return await callAlternativeAI();
                }

                const data = await response.json();
                const aiResponse = data.choices[0]?.message?.content;
                
                return {
                    interpretation: aiResponse || "No interpretation provided.",
                    insights: generateAIInsights(aiResponse),
                    modelUsed: model.name,
                    provider: model.provider
                };
                
            } catch (error) {
                console.error('OpenRouter API error:', error);
                throw new Error(`AI service temporarily unavailable. Using offline interpretation.`);
            }
        }

        // Alternative free AI service
        async function callAlternativeAI() {
            try {
                // Try using a different approach - some models might work better
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'Celestial Tarot'
                    },
                    body: JSON.stringify({
                        model: 'mistralai/mistral-7b-instruct', // Usually reliable and free
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a tarot reading expert. Provide detailed, compassionate tarot interpretations.'
                            },
                            {
                                role: 'user',
                                content: `Interpret this tarot reading for question: "${userQuestion}" with cards: ${selectedCards.map(c => c.name).join(', ')}`
                            }
                        ],
                        max_tokens: 1500,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('Alternative service failed');
                }

                const data = await response.json();
                return {
                    interpretation: data.choices[0]?.message?.content || "Interpretation generated.",
                    insights: ["Trust your intuition", "Consider all perspectives", "Take aligned action"],
                    modelUsed: "Mistral 7B",
                    provider: "Mistral AI"
                };
                
            } catch (error) {
                throw error;
            }
        }

        // Generate insights from AI response
        function generateAIInsights(aiResponse) {
            const insights = [];
            
            // Extract key insights from AI response
            if (aiResponse && aiResponse.includes('action') || aiResponse.includes('take') || aiResponse.includes('move')) {
                insights.push({
                    icon: "fas fa-running",
                    title: "Action Required",
                    text: "Your reading suggests taking decisive steps forward."
                });
            }
            
            if (aiResponse && (aiResponse.includes('patience') || aiResponse.includes('wait') || aiResponse.includes('time'))) {
                insights.push({
                    icon: "fas fa-hourglass-half",
                    title: "Patience Needed",
                    text: "The cards indicate timing is important."
                });
            }
            
            if (aiResponse && (aiResponse.includes('intuition') || aiResponse.includes('feel') || aiResponse.includes('gut'))) {
                insights.push({
                    icon: "fas fa-brain",
                    title: "Trust Intuition",
                    text: "Your inner wisdom is your best guide."
                });
            }
            
            if (aiResponse && (aiResponse.includes('balance') || aiResponse.includes('harmony') || aiResponse.includes('middle'))) {
                insights.push({
                    icon: "fas fa-balance-scale",
                    title: "Seek Balance",
                    text: "Find equilibrium in your approach."
                });
            }
            
            // Add default insights if not enough extracted
            if (insights.length < 3) {
                insights.push(
                    {
                        icon: "fas fa-lightbulb",
                        title: "Self-Reflection",
                        text: "Take time to reflect on what resonates with you."
                    },
                    {
                        icon: "fas fa-heart",
                        title: "Emotional Awareness",
                        text: "Pay attention to your emotional responses."
                    },
                    {
                        icon: "fas fa-road",
                        title: "Path Forward",
                        text: "Each step you take creates your journey."
                    }
                );
            }
            
            return insights.slice(0, 4); // Return max 4 insights
        }

        // Generate offline interpretation (fallback)
        function generateOfflineInterpretation() {
            const question = userQuestion.toLowerCase();
            let focusArea = "your situation";
            
            if (question.includes('love') || question.includes('relationship')) {
                focusArea = "your relationships and emotional life";
            } else if (question.includes('career') || question.includes('job') || question.includes('work')) {
                focusArea = "your professional path and career";
            } else if (question.includes('money') || question.includes('finance') || question.includes('wealth')) {
                focusArea = "your financial situation and abundance";
            }
            
            const card1 = selectedCards[0];
            const card2 = selectedCards[1];
            const card3 = selectedCards[2];
            
            let interpretation = `<p>Your question about <strong>${focusArea}</strong> has drawn an insightful combination of cards.</p>`;
            
            interpretation += `<p><strong>${card1.name}</strong> in the past position indicates that ${card1.meaning.toLowerCase()}.</p>`;
            interpretation += `<p><strong>${card2.name}</strong> in the present position suggests ${card2.meaning.toLowerCase()}.</p>`;
            interpretation += `<p><strong>${card3.name}</strong> in the future position points toward ${card3.meaning.toLowerCase()}.</p>`;
            
            interpretation += `<p>Consider how these three energies interact and what guidance they offer for your specific question.</p>`;
            
            return interpretation;
        }

        // Generate offline insights (fallback)
        function generateOfflineInsights() {
            return [
                {
                    icon: "fas fa-star",
                    title: "Major Life Lessons",
                    text: "Your reading contains significant cards that indicate important life lessons and spiritual growth opportunities."
                },
                {
                    icon: "fas fa-balance-scale",
                    title: "Practical Guidance",
                    text: "Your reading focuses on practical, day-to-day matters with actionable insights for your current situation."
                },
                {
                    icon: "fas fa-hourglass-half",
                    title: "Timing Considerations",
                    text: "The cards suggest influences that may unfold over several months, with particular emphasis on future development."
                },
                {
                    icon: "fas fa-lightbulb",
                    title: "Intuitive Guidance",
                    text: "Trust your intuition when applying this reading to your specific circumstances and life path."
                }
            ];
        }

        // ===== Main AI Reading Function =====
        async function generateAIReading() {
            // Validate selection
            if (selectedCards.length !== 3) {
                alert('Please select exactly 3 cards for a reading.');
                return;
            }
            
            // Hide card selection, show AI reading section
            cardSelectionSection.style.display = 'none';
            aiReadingSection.style.display = 'block';
            
            // Show loading state
            aiLoading.style.display = 'block';
            aiError.style.display = 'none';
            aiReadingContent.style.display = 'none';
            
            // Scroll to top of section
            aiReadingSection.scrollIntoView({ behavior: 'smooth' });
            
            try {
                let aiResult;
                
                // Try free AI first
                try {
                    aiResult = await callFreeAI();
                    
                    // Hide loading, show content
                    aiLoading.style.display = 'none';
                    aiReadingContent.style.display = 'block';
                    
                    // Display the reading with AI info
                    displayAIReading(aiResult.interpretation, aiResult.insights, aiResult.modelUsed, aiResult.provider);
                    
                } catch (aiError) {
                    // Fallback to offline
                    console.log('Falling back to offline interpretation:', aiError);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    aiLoading.style.display = 'none';
                    aiReadingContent.style.display = 'block';
                    
                    const interpretation = generateOfflineInterpretation();
                    const insights = generateOfflineInsights();
                    
                    displayAIReading(interpretation, insights, "Offline Tarot Expert", "Celestial Tarot");
                }
                
            } catch (error) {
                // Final fallback
                aiLoading.style.display = 'none';
                aiReadingContent.style.display = 'block';
                
                const interpretation = generateOfflineInterpretation();
                const insights = generateOfflineInsights();
                
                displayAIReading(interpretation, insights, "Tarot Wisdom System", "Celestial Tarot");
            }
        }

        // Modified displayAIReading to show AI info
        function displayAIReading(interpretation, insights, modelName = "AI Tarot Expert", provider = "AI Service") {
            // Clear previous content
            cardPositionsContainer.innerHTML = '';
            insightsGrid.innerHTML = '';
            
            // Add AI info badge
            const aiHeader = document.querySelector('.ai-header');
            
            // Remove existing badge if any
            const existingBadge = aiHeader.querySelector('.ai-info-badge');
            if (existingBadge) {
                existingBadge.remove();
            }
            
            const aiInfoBadge = document.createElement('div');
            aiInfoBadge.className = 'ai-info-badge';
            aiInfoBadge.style.cssText = `
                background: linear-gradient(135deg, var(--accent), #00a896);
                color: white;
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 0.9rem;
                font-weight: 500;
                margin-bottom: 20px;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            `;
            aiInfoBadge.innerHTML = `<i class="fas fa-robot"></i> Powered by ${modelName} (${provider})`;
            
            if (aiHeader) {
                aiHeader.appendChild(aiInfoBadge);
            }
            
            // Define positions
            const positions = [
                { title: "PAST INFLUENCES", description: "What has brought you to this point" },
                { title: "PRESENT SITUATION", description: "Your current circumstances" },
                { title: "FUTURE POTENTIAL", description: "Possible outcomes and directions" }
            ];
            
            // Create position cards
            selectedCards.forEach((card, index) => {
                const position = positions[index];
                
                const positionCard = document.createElement('div');
                positionCard.className = 'position-card';
                positionCard.innerHTML = `
                    <div class="position-title">${position.title}</div>
                    <div class="position-card-name">${card.name}</div>
                    <div class="position-card-meaning">${card.shortMeaning}</div>
                    <div class="position-card-image"><img style="width: 100%; border-radius: var(--radius);" src="${card.image}" alt="${card.name}"></div>
                    <div style="color: ${card.color}; font-size: 2rem; margin: 15px 0;">${card.icon}</div>
                    <div style="font-size: 0.9rem; color: var(--text-light);">${position.description}</div>
                `;
                
                cardPositionsContainer.appendChild(positionCard);
            });
            
            // Display interpretation
            interpretationText.innerHTML = formatAIResponse(interpretation);
            
            // Display insights
            insights.forEach(insight => {
                const insightElement = document.createElement('div');
                insightElement.className = 'insight-item';
                insightElement.innerHTML = `
                    <h4><i class="${insight.icon}"></i> ${insight.title}</h4>
                    <p>${insight.text}</p>
                `;
                insightsGrid.appendChild(insightElement);
            });
        }

        // Format AI response with better readability
       function formatAIResponse(text) {
    if (!text) return '<div class="no-interpretation">No interpretation available.</div>';
    
    // Process the text into beautiful HTML
    let formattedHTML = '';
    
    // Split by main sections (based on common tarot reading formats)
    const sections = text.split(/\n---\n|\n\*\*\*/g);
    
    sections.forEach((section, sectionIndex) => {
        const trimmedSection = section.trim();
        if (!trimmedSection) return;
        
        // Check if this is the title section
        if (sectionIndex === 0 && trimmedSection.includes('**Tarot Reading:**')) {
            formattedHTML += formatTitleSection(trimmedSection);
        }
        // Check if this is a card interpretation section
        else if (trimmedSection.includes('Card 1:') || trimmedSection.includes('Card 2:') || trimmedSection.includes('Card 3:')) {
            formattedHTML += formatCardSection(trimmedSection);
        }
        // Check if this is "How the Cards Connect"
        else if (trimmedSection.includes('How the Cards Connect')) {
            formattedHTML += formatConnectionSection(trimmedSection);
        }
        // Check if this is "Practical Insights and Guidance"
        else if (trimmedSection.includes('Practical Insights and Guidance')) {
            formattedHTML += formatInsightsSection(trimmedSection);
        }
        // Check if this is "Final Message"
        else if (trimmedSection.includes('Final Message')) {
            formattedHTML += formatFinalMessage(trimmedSection);
        }
        // Generic section (may contain markdown headings)
        else {
            formattedHTML += formatGenericSection(trimmedSection);
        }
    });
    
    // If no sections were identified (e.g., plain text response), format as generic
    if (!formattedHTML && text) {
        formattedHTML = formatGenericSection(text);
    }
    
    return formattedHTML;
}

// Helper functions for different section types
function formatTitleSection(section) {
    const lines = section.split('\n');
    let html = '';
    let questionFound = false;
    
    lines.forEach((line, index) => {
        const trimmedLine = line.trim();
        
        if (trimmedLine.includes('**Tarot Reading:**')) {
            const title = trimmedLine.replace('**Tarot Reading:**', '').trim();
            html += `
                <div class="reading-title-section" style="text-align: center; margin-bottom: 40px;">
                    <h2 style="
                        font-size: 2.2rem;
                        color: var(--primary);
                        margin-bottom: 15px;
                        font-family: 'Playfair Display', serif;
                        line-height: 1.3;
                    ">
                        <i class="fas fa-crystal-ball" style="margin-right: 10px;"></i>
                        ${title}
                    </h2>
            `;
        } else if (trimmedLine.includes('Question:')) {
            const question = trimmedLine.replace('Question:', '').trim().replace(/["']/g, '');
            html += `
                    <div style="
                        font-size: 1.2rem;
                        color: var(--text-light);
                        font-style: italic;
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 20px;
                        background: linear-gradient(135deg, rgba(139, 95, 191, 0.05), rgba(255, 107, 139, 0.05));
                        border-radius: var(--radius);
                        border-left: 4px solid var(--primary);
                    ">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-question-circle" style="color: var(--primary);"></i>
                            <strong style="color: var(--primary);">Your Question:</strong>
                        </div>
                        "${question}"
                    </div>
                </div>
                <hr style="
                    border: none;
                    height: 2px;
                    background: linear-gradient(to right, transparent, var(--primary), transparent);
                    margin: 40px 0;
                ">
            `;
            questionFound = true;
        }
    });
    
    // Close div if question wasn't found
    if (!questionFound) {
        html += `</div>`;
    }
    
    return html;
}

function formatCardSection(section) {
    const lines = section.split('\n').filter(line => line.trim());
    let html = '';
    let cardNumber = '';
    let cardTitle = '';
    let cardContent = '';
    
    lines.forEach((line, index) => {
        const trimmedLine = line.trim();
        
        if (index === 0) {
            // First line contains card info
            const match = trimmedLine.match(/(Card \d+: Past Influences|Present Situation|Future Potential) - (.*)/);
            if (match) {
                cardNumber = match[1].split(':')[0];
                cardTitle = match[1];
                const cardName = match[2];
                
                // Find the corresponding selected card
                const cardIndex = parseInt(cardNumber.replace('Card ', '')) - 1;
                const card = selectedCards[cardIndex];
                const cardColor = card ? card.color : 'var(--primary)';
                
                html += `
                    <div class="card-interpretation" style="
                        background: ${cardIndex % 2 === 0 ? 'white' : 'var(--light)'};
                        padding: 30px;
                        border-radius: var(--radius);
                        margin-bottom: 30px;
                        border-left: 5px solid ${cardColor};
                        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
                        position: relative;
                        overflow: hidden;
                    ">
                        <div style="
                            position: absolute;
                            top: 0;
                            right: 0;
                            width: 80px;
                            height: 80px;
                            background: ${cardColor};
                            opacity: 0.1;
                            border-radius: 0 0 0 80px;
                        "></div>
                        
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                            <div style="
                                width: 50px;
                                height: 50px;
                                background: ${cardColor};
                                color: white;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-weight: bold;
                                font-size: 1.2rem;
                                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                            ">
                                ${cardNumber.replace('Card ', '')}
                            </div>
                            <div>
                                <h3 style="
                                    color: var(--dark);
                                    margin: 0 0 5px 0;
                                    font-size: 1.4rem;
                                    font-family: 'Playfair Display', serif;
                                ">
                                    ${cardTitle.replace(cardNumber + ': ', '')}
                                </h3>
                                <div style="
                                    color: ${cardColor};
                                    font-weight: 600;
                                    font-size: 1.1rem;
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                ">
                                    <i class="fas fa-star" style="font-size: 0.9rem;"></i>
                                    ${cardName}
                                </div>
                            </div>
                        </div>
                `;
            }
        } else {
            // Handle markdown headings within card sections
            if (trimmedLine.startsWith('### ')) {
                const headingText = trimmedLine.replace('### ', '').trim();
                cardContent += `<h4 style="
                    color: var(--secondary);
                    margin: 25px 0 15px 0;
                    font-size: 1.3rem;
                    font-family: 'Playfair Display', serif;
                    border-bottom: 2px solid var(--border);
                    padding-bottom: 8px;
                ">${headingText}</h4>`;
            } else if (trimmedLine.startsWith('#### ')) {
                const subheadingText = trimmedLine.replace('#### ', '').trim();
                cardContent += `<h5 style="
                    color: var(--accent);
                    margin: 20px 0 12px 0;
                    font-size: 1.2rem;
                    font-family: 'Playfair Display', serif;
                ">${subheadingText}</h5>`;
            } else {
                // Regular content lines
                const formattedLine = formatTextLine(trimmedLine, true);
                cardContent += formattedLine;
            }
        }
    });
    
    html += `
            <div style="
                font-size: 1.1rem;
                line-height: 1.8;
                color: var(--text);
                font-family: 'Cormorant Garamond', serif;
            ">
                ${cardContent}
            </div>
        </div>
    `;
    
    return html;
}

function formatConnectionSection(section) {
    const content = section.replace('How the Cards Connect', '').trim();
    return `
        <div class="cards-connection" style="
            background: linear-gradient(135deg, rgba(139, 95, 191, 0.03), rgba(255, 107, 139, 0.03));
            padding: 35px;
            border-radius: var(--radius);
            margin: 40px 0;
            border: 2px solid var(--border);
            position: relative;
        ">
            <div style="
                position: absolute;
                top: -15px;
                left: 50%;
                transform: translateX(-50%);
                background: white;
                padding: 0 20px;
            ">
                <h3 style="
                    color: var(--secondary);
                    margin: 0;
                    font-size: 1.5rem;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    white-space: nowrap;
                    font-family: 'Playfair Display', serif;
                ">
                    <i class="fas fa-link"></i> How the Cards Connect
                </h3>
            </div>
            
            <div style="
                font-size: 1.15rem;
                line-height: 1.8;
                color: var(--text);
                font-family: 'Cormorant Garamond', serif;
                margin-top: 15px;
            ">
                ${formatTextLine(content, true)}
            </div>
        </div>
    `;
}

function formatInsightsSection(section) {
    const content = section.replace('Practical Insights and Guidance', '').trim();
    
    // Check if content has markdown headings
    if (content.includes('### ')) {
        return formatGenericSection(section);
    }
    
    const insights = content.split(/\d+\.\s+/).filter(item => item.trim());
    
    let insightsHTML = '';
    
    insights.forEach((insight, index) => {
        if (insight.trim()) {
            const insightParts = insight.split(':');
            const title = insightParts[0]?.trim() || `Insight ${index + 1}`;
            const text = insightParts.slice(1).join(':').trim();
            
            insightsHTML += `
                <div style="
                    background: white;
                    padding: 25px;
                    border-radius: var(--radius);
                    border-left: 4px solid var(--accent);
                    box-shadow: var(--shadow);
                    margin-bottom: 20px;
                    transition: transform 0.3s ease;
                " onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='none'">
                    <div style="display: flex; align-items: flex-start; gap: 20px;">
                        <div style="
                            width: 40px;
                            height: 40px;
                            min-width: 40px;
                            background: var(--accent);
                            color: white;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: bold;
                            font-size: 1.2rem;
                            box-shadow: 0 4px 10px rgba(0, 201, 183, 0.3);
                        ">
                            ${index + 1}
                        </div>
                        <div style="flex: 1;">
                            <h4 style="
                                font-size: 1.2rem;
                                color: var(--dark);
                                margin: 0 0 10px 0;
                                font-family: 'Playfair Display', serif;
                            ">
                                ${title}
                            </h4>
                            <div style="
                                font-size: 1.05rem;
                                line-height: 1.7;
                                color: var(--text);
                                font-family: 'Cormorant Garamond', serif;
                            ">
                                ${formatTextLine(text, true)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
    });
    
    return `
        <div class="practical-insights" style="margin: 50px 0;">
            <h3 style="
                color: var(--accent);
                margin-bottom: 30px;
                font-size: 1.6rem;
                display: flex;
                align-items: center;
                gap: 10px;
                font-family: 'Playfair Display', serif;
            ">
                <i class="fas fa-lightbulb" style="color: var(--accent);"></i>
                Practical Insights and Guidance
            </h3>
            <div class="insights-grid" style="display: grid; gap: 25px;">
                ${insightsHTML}
            </div>
        </div>
    `;
}

function formatFinalMessage(section) {
    const content = section.replace('Final Message', '').trim();
    return `
        <div class="final-message" style="
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 50px 40px;
            border-radius: var(--radius);
            margin-top: 50px;
            text-align: center;
            position: relative;
            overflow: hidden;
        ">
            <div style="
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
                pointer-events: none;
            "></div>
            
            <div style="position: relative; z-index: 2;">
                <h3 style="
                    color: white;
                    margin-bottom: 25px;
                    font-size: 1.8rem;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 15px;
                    font-family: 'Playfair Display', serif;
                ">
                    <i class="fas fa-heart" style="color: #FF6B8B;"></i>
                    Final Message
                    <i class="fas fa-heart" style="color: #FF6B8B;"></i>
                </h3>
                
                <div style="
                    font-size: 1.2rem;
                    line-height: 1.8;
                    opacity: 0.95;
                    max-width: 800px;
                    margin: 0 auto;
                    font-family: 'Cormorant Garamond', serif;
                    font-weight: 500;
                ">
                    ${formatTextLine(content, true)}
                </div>
                
                <div style="
                    margin-top: 40px;
                    font-size: 2.5rem;
                    opacity: 0.8;
                    display: flex;
                    justify-content: center;
                    gap: 20px;
                ">
                    <span>‚ú®</span>
                    <span>üåü</span>
                    <span>üí´</span>
                </div>
            </div>
        </div>
    `;
}

function formatGenericSection(section) {
    // Process markdown headings in generic sections
    const lines = section.split('\n');
    let contentHTML = '';
    
    lines.forEach(line => {
        const trimmedLine = line.trim();
        
        if (trimmedLine.startsWith('### ')) {
            const headingText = trimmedLine.replace('### ', '').trim();
            contentHTML += `<h3 style="
                color: var(--primary);
                margin: 30px 0 15px 0;
                font-size: 1.5rem;
                font-family: 'Playfair Display', serif;
                border-bottom: 2px solid var(--border);
                padding-bottom: 10px;
            ">${headingText}</h3>`;
        } else if (trimmedLine.startsWith('#### ')) {
            const subheadingText = trimmedLine.replace('#### ', '').trim();
            contentHTML += `<h4 style="
                color: var(--secondary);
                margin: 25px 0 12px 0;
                font-size: 1.3rem;
                font-family: 'Playfair Display', serif;
            ">${subheadingText}</h4>`;
        } else if (trimmedLine.startsWith('##### ')) {
            const subsubheadingText = trimmedLine.replace('##### ', '').trim();
            contentHTML += `<h5 style="
                color: var(--accent);
                margin: 20px 0 10px 0;
                font-size: 1.2rem;
                font-family: 'Playfair Display', serif;
            ">${subsubheadingText}</h5>`;
        } else if (trimmedLine) {
            contentHTML += formatTextLine(trimmedLine, true);
        }
    });
    
    return `
        <div style="
            margin: 20px 0;
            padding: 25px;
            background: white;
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        ">
            <div style="
                font-size: 1.1rem;
                line-height: 1.8;
                color: var(--text);
                font-family: 'Cormorant Garamond', serif;
            ">
                ${contentHTML}
            </div>
        </div>
    `;
}

function formatTextLine(line, isParagraph = true) {
    if (!line.trim()) return '';
    
    // Format bold text
    let formatted = line.replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--primary-dark); font-weight: 600;">$1</strong>');
    
    // Format italic text
    formatted = formatted.replace(/\*(.*?)\*/g, '<em style="font-style: italic; color: var(--text-light);">$1</em>');
    
    // Format bullet points
    formatted = formatted.replace(/^[-‚Ä¢]\s+(.*)/gm, '<div style="display: flex; align-items: flex-start; margin: 8px 0; padding-left: 5px;"><span style="color: var(--primary); margin-right: 10px; margin-top: 6px;">‚Ä¢</span><span>$1</span></div>');
    
    // Format numbered lists
    formatted = formatted.replace(/^(\d+)\.\s+(.*)/gm, '<div style="display: flex; align-items: flex-start; margin: 10px 0; padding-left: 5px;"><span style="color: var(--primary); font-weight: bold; margin-right: 10px; min-width: 25px;">$1.</span><span>$2</span></div>');
    
    // Handle paragraphs vs inline
    if (isParagraph) {
        // Check if it's already wrapped in a div (from bullet/number formatting)
        if (formatted.includes('<div') || formatted.includes('</div>')) {
            return formatted;
        }
        return `<p style="margin-bottom: 20px;">${formatted}</p>`;
    } else {
        return formatted;
    }
}

        function startNewReading() {
            // Reset application state
            userQuestion = "";
            selectedCards = [];
            currentFilter = "all";
            
            // Reset UI
            questionInput.value = "";
            aiReadingSection.style.display = 'none';
            cardSelectionSection.style.display = 'none';
            questionSection.style.display = 'block';
            
            // Reinitialize cards
            initializeCards();
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === 'all') {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Reset selected counter
            updateSelectedCounter();
            
            // Scroll to top
            questionSection.scrollIntoView({ behavior: 'smooth' });
        }

        function backToCardsFromReading() {
            aiReadingSection.style.display = 'none';
            cardSelectionSection.style.display = 'block';
            cardSelectionSection.scrollIntoView({ behavior: 'smooth' });
        }

        // ===== Helper Functions =====
        // ===== CORRECTED shuffleArray FUNCTION =====
        // ===== Helper Functions =====
        function shuffleArray(array) {
            // Create a copy WITHOUT JSON.stringify
            const newArray = [...array];
            
            // Fisher-Yates shuffle
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                
                // Swap using destructuring (for arrays) or temp variable
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            
            return newArray;
        }
        // ===== ENHANCED SMOOTH SHUFFLE ANIMATION =====
        // ===== SIMPLIFIED animatedShuffle WITH PROPER SHUFFLING =====
// ===== ENHANCED SMOOTH SHUFFLE ANIMATION WITH FIXED SHUFFLING =====
        async function animatedShuffle(times) {
            // Disable buttons during shuffle
            disableShuffleButtons(true);
            
            const cardDeck = document.getElementById('cardDeck');
            const cards = Array.from(cardDeck.children);
            const deckRect = cardDeck.getBoundingClientRect();
            
            for (let t = 0; t < times; t++) {
                // Step 1: Gather cards to center with elegant animation
                cards.forEach((card, index) => {
                    const cardInner = card.querySelector('.tarot-card-inner');
                    if (cardInner) {
                        cardInner.classList.remove('selected');
                    }
                    const rect = card.getBoundingClientRect();
                    const centerX = deckRect.left + deckRect.width / 2 - (rect.left + rect.width / 2);
                    const centerY = deckRect.top + deckRect.height / 2 - (rect.top + rect.height / 2);
                    
                    // Staggered animation with easing
                    card.style.transition = `transform ${0.5 + index * 0.02}s cubic-bezier(0.34, 1.56, 0.64, 1)`;
                    card.style.transform = `
                        translate(${centerX}px, ${centerY}px) 
                        rotate(${Math.random() * 30 - 15}deg)
                        scale(${0.85 + Math.random() * 0.1})
                    `;
                    card.style.zIndex = cards.length - index;
                });
                
                await sleep(800 + cards.length * 20);
                
                // Step 2: Create a beautiful fan/spread effect
                cards.forEach((card, index) => {
                    const angle = (index / cards.length) * 180 - 90; // -90 to +90 degrees
                    const radius = 200 + Math.random() * 50;
                    const x = Math.cos(angle * Math.PI / 180) * radius;
                    const y = Math.sin(angle * Math.PI / 180) * radius * 0.3;
                    
                    card.style.transition = `transform ${0.7}s cubic-bezier(0.19, 1, 0.22, 1)`;
                    card.style.transform = `
                        translate(${x}px, ${y}px) 
                        rotate(${angle + (Math.random() * 20 - 10)}deg)
                        scale(${0.9})
                    `;
                });
                
                await sleep(900);
                
                // Step 3: Quick shuffle jiggle effect
                for (let j = 0; j < 3; j++) {
                    cards.forEach(card => {
                        const shakeX = Math.random() * 20 - 10;
                        const shakeY = Math.random() * 10 - 5;
                        card.style.transform += ` translate(${shakeX}px, ${shakeY}px)`;
                    });
                    await sleep(150);
                    
                    cards.forEach(card => {
                        card.style.transform = card.style.transform.replace(/translate\([^)]+\)/, 'translate(0,0)');
                    });
                    await sleep(150);
                }
                
                // Step 4: Riffle shuffle simulation (visual trick) - FIXED VERSION
                if (cards.length > 10) {
                    const half = Math.floor(cards.length / 2);
                    const leftHalf = cards.slice(0, half);
                    const rightHalf = cards.slice(half);
                    
                    // Move halves apart
                    leftHalf.forEach(card => {
                        card.style.transition = `transform 0.6s ease`;
                        card.style.transform = `translateX(-80px) rotate(-8deg) scale(0.95)`;
                    });
                    
                    rightHalf.forEach(card => {
                        card.style.transition = `transform 0.6s ease`;
                        card.style.transform = `translateX(80px) rotate(8deg) scale(0.95)`;
                    });
                    
                    await sleep(700);
                    
                    // ‚úÖ FIXED: Properly shuffle DOM elements
                    // Collect all cards
                    const allCardsArray = [...leftHalf, ...rightHalf];
                    
                    // Fisher-Yates shuffle for DOM elements
                    for (let i = allCardsArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        // Swap DOM elements
                        const temp = allCardsArray[i];
                        allCardsArray[i] = allCardsArray[j];
                        allCardsArray[j] = temp;
                    }
                    
                    // Clear the deck and re-add shuffled cards
                    cardDeck.innerHTML = '';
                    allCardsArray.forEach(card => {
                        cardDeck.appendChild(card);
                    });
                    
                    // Update cards reference
                    const updatedCards = Array.from(cardDeck.children);
                    
                    // Bring cards back together
                    updatedCards.forEach(card => {
                        card.style.transition = `transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)`;
                        card.style.transform = `translate(0,0) rotate(0deg) scale(1)`;
                    });
                    
                    await sleep(900);
                }
                
                // Step 5: Final gentle spread with physics
                // const currentCards = Array.from(cardDeck.children);
                // currentCards.forEach((card, index) => {
                //     const delay = index * 30;
                //     const x = (Math.random() - 0.5) * 40;
                //     const y = (Math.random() - 0.5) * 20;
                //     const rotation = (Math.random() - 0.5) * 10;
                    
                //     setTimeout(() => {
                //         card.style.transition = `transform ${0.5}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`;
                //         card.style.transform = `
                //             translate(${x}px, ${y}px) 
                //             rotate(${rotation}deg)
                //             scale(1)
                //         `;
                //         card.style.zIndex = Math.floor(Math.random() * 1000);
                //     }, delay);
                // });
                
                await sleep(500 + cards.length * 30);
            }
            
            // // ‚úÖ FINAL SHUFFLE: One more shuffle after animations
            // const finalCards = Array.from(cardDeck.children);
            
            // // Simple shuffle for final mixing
            // for (let i = finalCards.length - 1; i > 0; i--) {
            //     const j = Math.floor(Math.random() * (i + 1));
            //     cardDeck.appendChild(finalCards[j]);
            // }
            
            // Final reset to original positions
            const allFinalCards = Array.from(cardDeck.children);
            allFinalCards.forEach(card => {
                card.style.transition = `transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)`;
                card.style.transform = `translate(0,0) rotate(0deg) scale(1)`;
                card.style.zIndex = '';
            });
            
            //await sleep(700);
            
            // Reset card styles
            allFinalCards.forEach(card => {
                card.style.transition = '';
                card.style.transform = '';
                card.style.zIndex = '';
            });
            
            // Reset selection
            selectedCards = [];
            updateSelectedCounter();
            updateSelectedPreview();
            getAIReadingBtn.disabled = true;
            
            disableShuffleButtons(false);
        }
        // Helper function for smooth sleep
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Disable/enable shuffle buttons
        function disableShuffleButtons(state) {
            document.querySelectorAll('.shuffle-controls button')
                .forEach(btn => {
                    btn.disabled = state;
                    btn.style.opacity = state ? '0.6' : '1';
                    btn.style.cursor = state ? 'not-allowed' : 'pointer';
                });
        }








        function getTypeColor(type) {
            switch(type) {
                case 'major': return '#8B5FBF';
                case 'cups': return '#3498db';
                case 'wands': return '#e74c3c';
                case 'swords': return '#95a5a6';
                case 'pentacles': return '#27ae60';
                default: return '#8B5FBF';
            }
        }

        function getTypeSymbol(type) {
            switch(type) {
                case 'major': return 'üåü';
                case 'cups': return 'üíß';
                case 'wands': return 'üî•';
                case 'swords': return '‚öîÔ∏è';
                case 'pentacles': return 'üí∞';
                default: return 'üÉè';
            }
        }

        function getTypeName(type) {
            switch(type) {
                case 'major': return 'Major Arcana';
                case 'cups': return 'Cups';
                case 'wands': return 'Wands';
                case 'swords': return 'Swords';
                case 'pentacles': return 'Pentacles';
                default: return 'Tarot';
            }
        }

        // ===== Event Listeners Setup =====
        function setupEventListeners() {
            // Question section
            questionInput.addEventListener('input', function() {
                userQuestion = this.value;
            });
            
            proceedToCardsBtn.addEventListener('click', proceedToCardSelection);
            
            // Card selection section
            backToQuestionBtn.addEventListener('click', backToQuestion);
            getAIReadingBtn.addEventListener('click', generateAIReading);
            
            // AI reading section
            backToCardsFromReadingBtn.addEventListener('click', backToCardsFromReading);
            newReadingBtn.addEventListener('click', startNewReading);
            retryAIButton.addEventListener('click', generateAIReading);
            
            // Mobile menu
            mobileMenuBtn.addEventListener('click', function() {
                mainNav.classList.toggle('active');
                mobileMenuBtn.innerHTML = mainNav.classList.contains('active') 
                    ? '<i class="fas fa-times"></i>' 
                    : '<i class="fas fa-bars"></i>';
            });
            
            // Close mobile menu on link click
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        mainNav.classList.remove('active');
                        mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
                    }
                });
            });
        }
    </script>
</body>
</html>